{
  "createdAt": "2025-09-22T12:48:56.558Z",
  "updatedAt": "2025-09-22T12:48:56.558Z",
  "id": "pKdCthU583MCDBkX",
  "name": "github_robot",
  "active": false,
  "isArchived": false,
  "nodes": [
    {
      "parameters": {
        "model": {
          "__rl": true,
          "mode": "list",
          "value": "gpt-4o-mini"
        },
        "options": {}
      },
      "id": "00b398c7-10a8-4801-8de0-8e2af37b168d",
      "name": "OpenAI Chat Model",
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "position": [
        320,
        480
      ],
      "typeVersion": 1.2
    },
    {
      "parameters": {
        "authentication": "oAuth2",
        "owner": {
          "__rl": true,
          "mode": "list",
          "value": "",
          "cachedResultUrl": "",
          "cachedResultName": ""
        },
        "repository": {
          "__rl": true,
          "mode": "list",
          "value": "",
          "cachedResultUrl": "",
          "cachedResultName": ""
        },
        "events": [
          "pull_request"
        ],
        "options": {}
      },
      "id": "af3bc7be-a042-40ee-9fce-70035ac86d77",
      "name": "PR Trigger",
      "type": "n8n-nodes-base.githubTrigger",
      "position": [
        -320,
        272
      ],
      "webhookId": "2b8ec7bd-e65b-46d2-a2d9-082b137dd880",
      "notesInFlow": false,
      "typeVersion": 1
    },
    {
      "parameters": {
        "url": "=https://api.github.com/repos/{{$json.body.sender.login}}/{{$json.body.repository.name}}/pulls/{{$json.body.number}}/files",
        "options": {}
      },
      "id": "3e450df4-caea-4656-aae9-c29eb323788a",
      "name": "Get file's Diffs from PR",
      "type": "n8n-nodes-base.httpRequest",
      "position": [
        -96,
        272
      ],
      "typeVersion": 4.2
    },
    {
      "parameters": {
        "jsCode": "const files = $input.all().map(item => item.json);

let diffs = '';

for (const file of files) {
  diffs += `### Fichier : ${file.filename}\
\
`;

  if (file.patch) {
    // IMPORTANT : On remplace tous les triple backticks par simple (ou Ã©chappement)
    const safePatch = file.patch.replace(/```/g, \"''\");

    diffs += \"```diff\
\";
    diffs += safePatch;
    diffs += \"\
```\
\";
  } else {
    diffs += \"_Pas de patch disponible (probablement fichier binaire)._\";
  }

  diffs += \"\
---\
\
\";
}

const userMessage = `
You are a senior iOS developer. 
Please review the following code changes in these files :

${diffs}

---

Your mission:

- Review the proposed code changes file by file and by significant modification.

- Generate inline comments on the relevant lines of code.

- Ignore files without patches.

- Do not repeat the code snippet or the filename.

- Write the comments directly, without introducing the context.
`;

return [
  {
    json: {
      user_message: userMessage.trim()
    }
  }
];"
      },
      "id": "48741426-3c2f-4a82-b741-dce67c4e4fdd",
      "name": "Create target Prompt from PR Diffs",
      "type": "n8n-nodes-base.code",
      "position": [
        128,
        272
      ],
      "typeVersion": 2
    },
    {
      "parameters": {
        "resource": "review",
        "owner": {
          "__rl": true,
          "mode": "list",
          "value": "",
          "cachedResultUrl": "",
          "cachedResultName": ""
        },
        "repository": {
          "__rl": true,
          "mode": "list",
          "value": "",
          "cachedResultUrl": "",
          "cachedResultName": ""
        },
        "pullRequestNumber": "={{ $('PR Trigger').first().json.body.number }}",
        "event": "comment",
        "body": "={{ $json.output }}",
        "additionalFields": {}
      },
      "id": "3d9ba364-dea2-4b29-a729-5e0af955017d",
      "name": "GitHub Robot",
      "type": "n8n-nodes-base.github",
      "position": [
        720,
        272
      ],
      "webhookId": "39c2fe8b-f686-4699-8450-2a5b4c263d93",
      "typeVersion": 1.1
    },
    {
      "parameters": {
        "authentication": "oAuth2",
        "operation": "edit",
        "owner": {
          "__rl": true,
          "mode": "list",
          "value": "",
          "cachedResultUrl": "",
          "cachedResultName": ""
        },
        "repository": {
          "__rl": true,
          "mode": "list",
          "value": "",
          "cachedResultUrl": "",
          "cachedResultName": ""
        },
        "issueNumber": "={{ $('PR Trigger').first().json.body.number }}",
        "editFields": {
          "labels": [
            {
              "label": "ReviewedByAI"
            }
          ]
        }
      },
      "id": "51b9d093-c61c-4aa1-bf71-c5162356e6ca",
      "name": "Add Label to PR",
      "type": "n8n-nodes-base.github",
      "position": [
        944,
        272
      ],
      "webhookId": "c98f39f1-603b-4013-9149-53b4cc31b611",
      "typeVersion": 1
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "mode": "url",
          "value": ""
        },
        "sheetName": {
          "__rl": true,
          "mode": "name",
          "value": ""
        }
      },
      "id": "cab3da7c-be97-412c-a274-f650b2ddec0c",
      "name": "Code Best Practices",
      "type": "n8n-nodes-base.googleSheetsTool",
      "position": [
        496,
        480
      ],
      "typeVersion": 4.5
    },
    {
      "parameters": {
        "content": "**1-The GitHub Trigger** node initiates the workflow whenever a pull request event occurs on a specified repository. It enables real-time automation based on GitHub activity.
"
      },
      "id": "608cfe8c-3889-4c67-8e70-e4e23473d3f6",
      "name": "Sticky Note",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -464,
        80
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "content": "**2-Get PR Diffs**
The HTTP Request node fetches the list of changed files and their diffs from the pull request that triggered the workflow. It uses the GitHub REST API to retrieve this data dynamically based on the trigger payload.

https://api.github.com/repos/{{$json.body.sender.login}}/{{$json.body.repository.name}}/pulls/{{$json.body.number}}/files",
        "height": 220,
        "width": 340,
        "color": 3
      },
      "id": "9f632013-a6cb-4aba-994d-a32fa136146b",
      "name": "Sticky Note1",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -256,
        448
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "content": "**3-Create Prompt from diffs**
This Code node runs a JavaScript snippet to:
-Parse file diffs from the previous HTTP Request node
-Format each diff with its file name
-Build a structured natural language prompt for the AI agent

The final output is a clear, contextual instruction like:
*\"You are a senior iOS developer. Please review the following code changes in these files...\"*
",
        "height": 240,
        "width": 360,
        "color": 2
      },
      "id": "907b58cb-4187-4b56-a117-41a8eacfd352",
      "name": "Sticky Note2",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        0,
        0
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "content": "**Github Comment Poster**
Posts the AI-generated review as a comment on the pull request using GitHub API.",
        "color": 5
      },
      "id": "a73d9666-c5f9-4dd3-8b54-b8b0abaaf477",
      "name": "Sticky Note3",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        624,
        80
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $json.user_message }}",
        "options": {}
      },
      "id": "5df7e725-2136-4aec-a303-750e41cecd96",
      "name": "Code Review Agent",
      "type": "@n8n/n8n-nodes-langchain.agent",
      "position": [
        352,
        272
      ],
      "typeVersion": 1.9
    },
    {
      "parameters": {
        "content": "**PR Labeler (optional)**
Automatically adds a label like *ReviewedByAI* to the pull request once the AI comment is posted.",
        "height": 120,
        "color": 7
      },
      "id": "cb676e1e-7d50-4aec-94c2-5d4ecabb5db3",
      "name": "Sticky Note4",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        880,
        128
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "content": "**Google Sheet Best Practices**
Enables the AI agent to reference to your team coding guidelines stored in a Google Sheet for more accurate and opinionated reviews.
You can replace Google Sheets with any other database or tool.",
        "width": 260,
        "color": 6
      },
      "id": "015e62b4-403f-4f46-94f6-422f07960360",
      "name": "Sticky Note5",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        608,
        464
      ],
      "typeVersion": 1
    }
  ],
  "connections": {
    "PR Trigger": {
      "main": [
        [
          {
            "node": "Get file's Diffs from PR",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "GitHub Robot": {
      "main": [
        [
          {
            "node": "Add Label to PR",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code Review Agent": {
      "main": [
        [
          {
            "node": "GitHub Robot",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "Code Review Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Code Best Practices": {
      "ai_tool": [
        [
          {
            "node": "Code Review Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Get file's Diffs from PR": {
      "main": [
        [
          {
            "node": "Create target Prompt from PR Diffs",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Create target Prompt from PR Diffs": {
      "main": [
        [
          {
            "node": "Code Review Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "settings": {
    "executionOrder": "v1"
  },
  "staticData": null,
  "meta": null,
  "pinData": {},
  "versionId": "56aa043b-83c1-45e7-9a66-827be761ec7c",
  "triggerCount": 0,
  "shared": [
    {
      "createdAt": "2025-09-22T12:48:56.558Z",
      "updatedAt": "2025-09-22T12:48:56.558Z",
      "role": "workflow:owner",
      "workflowId": "pKdCthU583MCDBkX",
      "projectId": "XDSXqJERuGM10SXD"
    }
  ],
  "tags": []
}